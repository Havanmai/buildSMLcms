"use strict";(self.webpackChunksmartlocker_workspace=self.webpackChunksmartlocker_workspace||[]).push([[349],{62349:(X,C,r)=>{r.r(C),r.d(C,{RolesModule:()=>L});var h=r(38583),d=r(39895),a=r(3679),c=r(34100),e=r(37716),Z=r(91841);let v=(()=>{class i{constructor(t){this.httpClient=t}getAllPermission(){return this.httpClient.get("smartlocker/api/v1/admin/permissions/get-tree-permission")}getAllRoles(){return this.httpClient.get("smartlocker/api/v1/admin/authorities")}createRole(t,n,o){let l={description:n,name:t,permissions:[]};return o.forEach(m=>{l.permissions.push({id:m})}),this.httpClient.post("smartlocker/api/v1/admin/authority",JSON.stringify(l))}updateRole(t,n,o){let l={description:n,name:t,permissions:[]};return o.forEach(m=>{l.permissions.push({id:m})}),this.httpClient.put("smartlocker/api/v1/admin/authorities/"+t,JSON.stringify(l))}deleteRole(t){return this.httpClient.delete("smartlocker/api/v1/admin/authorities/"+t)}getRoleDetail(t){return this.httpClient.get("smartlocker/api/v1/admin/authorities/"+t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Z.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var g=r(14453),F=r(29374),A=r(84514),z=r(53599),u=r(75887),f=r(16704),_=r(57674),S=r(82677),b=r(62482),T=r(34812),E=r(52079);function y(i,s){1&i&&e._UZ(0,"nz-empty",22)}function k(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",28),e.TgZ(1,"label",29),e.NdJ("ngModelChange",function(o){return e.CHM(t).$implicit.checked=o})("ngModelChange",function(){const l=e.CHM(t).$implicit,m=e.oxw().$implicit;return e.oxw(2).selectItem(l,m.id)}),e._uU(2),e.qZA(),e.qZA()}if(2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngModel",t.checked),e.xp6(1),e.Oqu(t.name)}}function J(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"label",30),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().$implicit.checkAll=o})("click",function(o){return o.stopPropagation()})("ngModelChange",function(){e.CHM(t);const o=e.oxw().$implicit;return e.oxw(2).checkAll(o.id)}),e._uU(1,"Ch\u1ecdn t\u1ea5t c\u1ea3"),e.qZA()}if(2&i){const t=e.oxw().$implicit;e.Q6J("ngModel",t.checkAll)("nzIndeterminate",t.indeterminate)}}function M(i,s){if(1&i&&(e.TgZ(0,"nz-collapse-panel",24),e.TgZ(1,"div",25),e.YNc(2,k,3,2,"div",26),e.qZA(),e.YNc(3,J,2,2,"ng-template",null,27,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(4);e.Q6J("nzHeader",t.name+" ("+t.permissions.length+")")("nzExtra",n)("nzActive",!1),e.xp6(1),e.Q6J("nzGutter",12),e.xp6(1),e.Q6J("ngForOf",t.permissions)}}function O(i,s){if(1&i&&(e.TgZ(0,"nz-collapse"),e.YNc(1,M,5,5,"nz-collapse-panel",23),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.pemissionTree)}}let R=(()=>{class i{constructor(t,n,o,l){this.fb=t,this.baseService=n,this.roleService=o,this.activeRouter=l,this.currentSelected=[],this.formSubmitting=!1,this.editMode=!1}ngOnInit(){this.createRoleForm=this.fb.group({id:[null],name:[null,[a.kI.required,a.kI.minLength(5),a.kI.maxLength(50)]],description:[null,[a.kI.required]]}),this.roleService.getAllPermission().subscribe(t=>{0===t.error&&(this.pemissionTree&&(this.pemissionTree.length=0),this.pemissionTree=[],t.data.forEach(n=>{let o={checkAll:!1,indeterminate:!1,id:n.id,name:n.name,permissions:[]};n.permissions.forEach(l=>{o.permissions.push({id:l.id,name:l.name,checked:!1})}),this.pemissionTree.push(o)}),this.currentSelected&&this.currentSelected.length>0&&this.mergeSelected())}),this.sub=this.activeRouter.params.subscribe(t=>{this.roleName=t.id,this.roleName&&(this.editMode=!0,this.roleService.getRoleDetail(this.roleName).subscribe(n=>{0==n.error&&(this.createRoleForm.get("name").setValue(n.data.name),this.createRoleForm.get("description").setValue(n.data.description),n.data.permissions&&n.data.permissions.length>0&&(n.data.permissions.forEach(o=>{this.currentSelected.push(o.id)}),this.pemissionTree&&this.pemissionTree.length>0&&this.mergeSelected()))}))})}checkAll(t){for(let n=0;n<this.pemissionTree.length;n++)if(this.pemissionTree[n].id===t){this.pemissionTree[n].indeterminate=!1,this.pemissionTree[n].permissions.forEach(this.pemissionTree[n].checkAll?o=>{o.checked=!0,this.selectPermission(o.id)}:o=>{o.checked=!1,this.removeSelectedPermission(o.id)});break}}selectItem(t,n){t.checked?this.selectPermission(t.id):this.removeSelectedPermission(t.id),this.calculateStatus(n)}calculateStatus(t){for(let n=0;n<this.pemissionTree.length;n++)if(this.pemissionTree[n].id===t){let o=0;this.pemissionTree[n].permissions.forEach(l=>{l.checked&&o++}),o<=0?(this.pemissionTree[n].checkAll=!1,this.pemissionTree[n].indeterminate=!1):o>=this.pemissionTree[n].permissions.length?(this.pemissionTree[n].checkAll=!0,this.pemissionTree[n].indeterminate=!1):(this.pemissionTree[n].checkAll=!1,this.pemissionTree[n].indeterminate=!0);break}}selectPermission(t){this.currentSelected.includes(t)||this.currentSelected.push(t)}removeSelectedPermission(t){for(let n=0;n<this.currentSelected.length;n++)if(this.currentSelected[n]===t){this.currentSelected.splice(n,1);break}}submitRole(){for(const t in this.createRoleForm.controls)this.createRoleForm.controls.hasOwnProperty(t)&&(this.createRoleForm.controls[t].markAsDirty(),this.createRoleForm.controls[t].updateValueAndValidity());this.createRoleForm.invalid||(this.formSubmitting=!0,this.editMode?this.roleService.updateRole(this.createRoleForm.get("name").value,this.createRoleForm.get("description").value,this.currentSelected).subscribe(t=>{this.formSubmitting=!1,0==t.error&&this.baseService.showToast("C\u1eadp nh\u1eadt vai tr\xf2 th\xe0nh c\xf4ng",c.gT.TOAST_OK),setTimeout(()=>{this.baseService.navigateTo("/roles")},200)},()=>{this.formSubmitting=!1}):this.roleService.createRole(this.createRoleForm.get("name").value,this.createRoleForm.get("description").value,this.currentSelected).subscribe(t=>{this.formSubmitting=!1,0==t.error&&this.baseService.showToast("T\u1ea1o vai tr\xf2 th\xe0nh c\xf4ng",c.gT.TOAST_OK),setTimeout(()=>{this.baseService.navigateTo("/roles")},200)},()=>{this.formSubmitting=!1}))}checkAllGroup(t){this.pemissionTree.forEach(n=>{n.indeterminate=!1,n.checkAll=t,n.permissions.forEach(o=>{o.checked=t,t?this.selectPermission(o.id):this.removeSelectedPermission(o.id)})})}mergeSelected(){this.pemissionTree.forEach(t=>{t.permissions.forEach(n=>{this.currentSelected.includes(n.id)&&(n.checked=!0)}),this.calculateStatus(t.id)})}transformCode(){let t=this.createRoleForm.get("name").value;t=c.cQ.convertToEnglish(t),t=c.cQ.removeSpecialCharacters(t),t=t.replace(/ /g,"_"),t=t.toUpperCase(),this.createRoleForm.get("name").setValue(t)}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.qu),e.Y36(c.bQ),e.Y36(v),e.Y36(d.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cms-create"]],decls:32,vars:17,consts:[[3,"title"],["action",""],["nz-button","","nzType","primary",3,"nzLoading","click"],["nz-icon","","nzTheme","outline",3,"nzType"],[1,"d-none","d-md-inline-block"],["content","",1,"my-3","mx-0","mx-md-3"],["nz-form","",1,"form-wr",3,"formGroup","ngSubmit"],[1,"d-none"],["type","hidden","nz-input","","id","id","formControlName","id"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nzErrorTip","M\xe3 vai tr\xf2 ph\u1ea3i t\u1ed1i thi\u1ec3u 5 v\xe0 d\u01b0\u1edbi 50 k\xfd t\u1ef1!",3,"nzSm","nzXs"],["nz-input","","formControlName","name","id","name","placeholder","Ex: ROLE_ACCOUNT_MANAGER",3,"input"],["nzFor","description","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Vui l\xf2ng nh\u1eadp t\xean hi\u1ec3n th\u1ecb!",3,"nzSm","nzXs"],["nz-input","","formControlName","description","id","description","placeholder","Nh\u1eadp t\xean hi\u1ec3n th\u1ecb"],[1,"permission-select-wr"],["nz-typography","",1,"mt-6","mb-4"],["nz-button","","nzType","primary","nzGhost","",1,"mx-3",3,"nzSize","click"],["nz-icon","","nzType","check","nzTheme","outline"],["nz-button","","nzType","default","nzGhost","",3,"nzSize","click"],["nzNotFoundImage","simple",4,"ngIf"],[4,"ngIf"],["nzNotFoundImage","simple"],[3,"nzHeader","nzExtra","nzActive",4,"ngFor","ngForOf"],[3,"nzHeader","nzExtra","nzActive"],["nz-row","",3,"nzGutter"],["nz-col","","nzXs","12","nzSm","8","nzMd","7","nzLg","6","nzXl","5","nzXXl","4","class","my-2",4,"ngFor","ngForOf"],["extraTpl",""],["nz-col","","nzXs","12","nzSm","8","nzMd","7","nzLg","6","nzXl","5","nzXXl","4",1,"my-2"],["nz-checkbox","",3,"ngModel","ngModelChange"],["nz-checkbox","",3,"ngModel","nzIndeterminate","ngModelChange","click"]],template:function(t,n){1&t&&(e.TgZ(0,"cms-page",0),e.TgZ(1,"div",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return n.submitRole()}),e._UZ(3,"i",3),e.TgZ(4,"span",4),e._uU(5),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",5),e.TgZ(7,"form",6),e.NdJ("ngSubmit",function(){return n.submitRole()}),e.TgZ(8,"nz-form-item",7),e._UZ(9,"input",8),e.qZA(),e.TgZ(10,"nz-form-item"),e.TgZ(11,"nz-form-label",9),e._uU(12,"M\xe3 vai tr\xf2"),e.qZA(),e.TgZ(13,"nz-form-control",10),e.TgZ(14,"nz-input-group"),e.TgZ(15,"input",11),e.NdJ("input",function(){return n.transformCode()}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(16,"nz-form-item"),e.TgZ(17,"nz-form-label",12),e._uU(18,"T\xean hi\u1ec3n th\u1ecb"),e.qZA(),e.TgZ(19,"nz-form-control",13),e._UZ(20,"input",14),e.qZA(),e.qZA(),e._UZ(21,"button",7),e.qZA(),e.TgZ(22,"div",15),e.TgZ(23,"h5",16),e._uU(24," Danh s\xe1ch quy\u1ec1n "),e.TgZ(25,"button",17),e.NdJ("click",function(){return n.checkAllGroup(!0)}),e._UZ(26,"i",18),e._uU(27," Ch\u1ecdn t\u1ea5t c\u1ea3 "),e.qZA(),e.TgZ(28,"button",19),e.NdJ("click",function(){return n.checkAllGroup(!1)}),e._uU(29," B\u1ecf ch\u1ecdn "),e.qZA(),e.qZA(),e.YNc(30,y,1,0,"nz-empty",20),e.YNc(31,O,2,1,"nz-collapse",21),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.Q6J("title",n.editMode?"Ch\u1ec9nh s\u1eeda vai tr\xf2":"T\u1ea1o m\u1edbi vai tr\xf2"),e.xp6(2),e.Q6J("nzLoading",n.formSubmitting),e.xp6(1),e.Q6J("nzType",n.formSubmitting?"loading":"save"),e.xp6(2),e.Oqu(n.editMode?"C\u1eadp nh\u1eadt":"T\u1ea1o m\u1edbi"),e.xp6(2),e.Q6J("formGroup",n.createRoleForm),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(6),e.Q6J("nzSize","small"),e.xp6(3),e.Q6J("nzSize","small"),e.xp6(2),e.Q6J("ngIf",!n.pemissionTree),e.xp6(1),e.Q6J("ngIf",n.pemissionTree))},directives:[c.Zd,g.ix,F.dQ,A.w,z.Ls,a._Y,a.JL,u.Lr,a.sg,f.SK,u.Nx,_.Zp,a.Fj,a.JJ,a.u,f.t3,u.iK,u.Fd,_.gB,S.ZU,h.O5,b.p9,T.yH,h.sg,T.Zv,E.Ie,a.On],styles:[".form-wr[_ngcontent-%COMP%]{max-width:800px;margin-top:30px}"]}),i})();var x=r(26214),p=r(43654);function q(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",9),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e.TgZ(6,"a",10),e._UZ(7,"i",11),e.qZA(),e.TgZ(8,"button",12),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw().deleteRole(l)}),e._UZ(9,"i",13),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=s.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Q6J("routerLink","update/"+t.name)}}const N=[{path:"",component:(()=>{class i{constructor(t,n,o){this.baseService=t,this.roleService=n,this.modal=o}ngOnInit(){setTimeout(()=>{this.reloadData()},200)}reloadData(){this.baseService.showLoading(!0),this.roleService.getAllRoles().subscribe(t=>{this.baseService.showLoading(!1),0==t.error&&(this.listRoles=t.data)},()=>{this.baseService.showLoading(!1)})}editRole(t){}deleteRole(t){this.modal.confirm({nzTitle:"<i>B\u1ea1n c\xf3 ch\u1eafc mu\u1ed1n x\xf3a vai tr\xf2 n\xe0y kh\xf4ng?</i>",nzContent:"<b>"+t.description+"</b>",nzOnOk:()=>{this.baseService.showLoading(!0),this.roleService.deleteRole(t.name).subscribe(n=>{this.baseService.showLoading(!1),0===n.error&&(this.baseService.showToast("X\xf3a vai tr\xf2 th\xe0nh c\xf4ng",c.gT.TOAST_OK),this.reloadData())},()=>{this.baseService.showLoading(!1)})},nzClosable:!1,nzCancelText:"T\xf4i kh\xf4ng mu\u1ed1n",nzOkText:"\u0110\u1ed3ng \xfd"})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(c.bQ),e.Y36(v),e.Y36(x.Sf))},i.\u0275cmp=e.Xpm({type:i,selectors:[["cms-roles"]],decls:18,vars:5,consts:[[3,"title","close"],["action",""],["nz-button","","nzType","primary","routerLink","create"],["nz-icon","","nzType","plus","nzTheme","outline"],[1,"d-none","d-md-inline-block"],["content","",1,"my-3","pt-5"],[3,"nzData","nzFrontPagination"],["nzWidth","160px"],[4,"ngFor","ngForOf"],[1,"text-bold"],["nz-button","","nzType","text","title","S\u1eeda",1,"mr-1",3,"routerLink"],["nz-icon","","nzType","edit","nzTheme","outline"],["nz-button","","nzType","text","title","X\xf3a",3,"click"],["nz-icon","","nzType","delete","nzTheme","outline",1,"text-danger"]],template:function(t,n){1&t&&(e.TgZ(0,"cms-page",0),e.TgZ(1,"div",1),e.TgZ(2,"a",2),e._UZ(3,"i",3),e.TgZ(4,"span",4),e._uU(5,"T\u1ea1o m\u1edbi"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",5),e.TgZ(7,"nz-table",6),e.TgZ(8,"thead"),e.TgZ(9,"tr"),e.TgZ(10,"th"),e._uU(11,"M\xe3 Vai tr\xf2"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"T\xean hi\u1ec3n th\u1ecb"),e.qZA(),e.TgZ(14,"th",7),e._uU(15,"H\xe0nh \u0111\u1ed9ng"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(16,"tbody"),e.YNc(17,q,10,3,"tr",8),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.Q6J("title","Qu\u1ea3n l\xfd Vai tr\xf2")("close",!1),e.xp6(7),e.Q6J("nzData",n.listRoles)("nzFrontPagination",!1),e.xp6(10),e.Q6J("ngForOf",n.listRoles))},directives:[c.Zd,g.ix,d.yS,A.w,z.Ls,p.N8,p.Om,p.$Z,p.Uo,p._C,p.p0,h.sg],styles:[""]}),i})()},{path:"create",component:R,data:{breadcrumb:"T\u1ea1o m\u1edbi"}},{path:"update/:id",component:R,data:{breadcrumb:"C\u1eadp nh\u1eadt"}}];let Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.Bz.forChild(N)],d.Bz]}),i})();var U=r(17018),D=r(80269);let L=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[h.ez,Q,U.vh,c.IR,g.sL,z.PV,_.o7,u.U5,a.u5,a.UX,f.Jb,p.HQ,D.LV,E.Wr,S.ZJ,x.Qp,T.cD,b.Xo,Z.JF]]}),i})()}}]);